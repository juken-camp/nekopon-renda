<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>üê± NEKOPON RENDA üê±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: #ffffff;
            color: #5D4037;
            overflow: hidden;
            height: 100vh;
            position: relative;
            font-size: 14px;
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
        }
        
        /* „Ç∑„É≥„Éó„É´ËÉåÊôØ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle at 30% 30%, rgba(139, 69, 19, 0.05) 2px, transparent 2px);
            background-size: 100px 100px;
            z-index: 0;
        }
        
        .container {
            position: relative;
            width: 100vw;
            height: calc(100vh - 280px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            z-index: 10;
            padding: 10px;
        }
        
        .title {
            font-size: 1.4em;
            margin: 5px 0;
            background: linear-gradient(45deg, #8D4500, #D2691E, #FF8C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .stats {
            display: flex;
            gap: 8px;
            margin: 8px 0;
            font-size: 0.8em;
            z-index: 10;
        }
        
        .stat {
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #FFF8DC 100%);
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid #D2691E;
            box-shadow: 0 2px 8px rgba(210, 105, 30, 0.15);
            min-width: 45px;
        }
        
        .stat-label {
            font-size: 0.7em;
            opacity: 0.8;
            font-weight: 600;
            color: #5D4037;
        }
        
        .stat-value {
            font-weight: 700;
            color: #8D4500;
            font-size: 1em;
            margin-top: 1px;
        }
        
        .course-selection {
            margin: 8px 0;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-width: 350px;
            width: 100%;
        }
        
        .course-selection h2 {
            margin: 8px 0;
            color: #8D4500;
            font-size: 0.9em;
            font-weight: 700;
            text-align: center;
        }
        
        .course-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }
        
        .course-btn {
            padding: 12px 20px;
            font-size: 0.85em;
            background: linear-gradient(135deg, #D2691E, #8D4500);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(139, 69, 19, 0.25);
            text-align: center;
            width: 100%;
            touch-action: manipulation;
        }
        
        .course-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(139, 69, 19, 0.3);
            background: linear-gradient(135deg, #FF8C00, #D2691E);
        }
        
        .course-btn small {
            display: block;
            font-size: 0.8em;
            opacity: 0.9;
            margin-top: 2px;
        }
        
        .game-area {
            display: none;
            text-align: center;
            z-index: 10;
            width: 95%;
            max-width: 600px;
            flex: 1;
            flex-direction: column;
            height: calc(100vh - 280px);
            overflow: hidden;
        }
        
        .word-display {
            font-size: 1.8em;
            margin: 8px 0;
            font-weight: 700;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.1em;
            background: linear-gradient(135deg, #ffffff 0%, #FFF8DC 100%);
            border-radius: 15px;
            padding: 12px;
            border: 2px solid #D2691E;
            box-shadow: 0 4px 15px rgba(210, 105, 30, 0.15);
        }
        
        .typed {
            color: #2E7D32;
            text-shadow: 0 0 10px rgba(46, 125, 50, 0.4);
            animation: typedPop 0.3s ease;
        }
        
        @keyframes typedPop {
            0% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .current {
            color: #8D4500;
            background: rgba(139, 69, 19, 0.15);
            padding: 2px 8px;
            border-radius: 8px;
            text-shadow: 0 0 15px rgba(139, 69, 19, 0.6);
            animation: currentBlink 1s ease-in-out infinite alternate;
        }
        
        @keyframes currentBlink {
            0% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .remaining {
            color: #999;
            opacity: 0.6;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
            border: 1px solid #D2691E;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFE0B2, #D2691E, #8D4500);
            width: 0%;
            transition: width 0.4s ease;
        }
        
        .combo-display {
            position: absolute;
            top: 8%;
            right: 5%;
            font-size: 0.9em;
            font-weight: 700;
            z-index: 15;
        }
        
        .combo-text {
            color: #FF8C00;
            text-shadow: 0 0 15px rgba(255, 140, 0, 0.8);
            animation: comboShine 0.6s ease-in-out infinite alternate;
        }
        
        @keyframes comboShine {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        .result-screen {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffffff 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid #D2691E;
            text-align: center;
            z-index: 25;
            box-shadow: 0 10px 30px rgba(210, 105, 30, 0.25);
            min-width: 300px;
            max-width: 90vw;
        }
        
        .result-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #8D4500, #D2691E, #FF8C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .restart-btn {
            padding: 10px 20px;
            font-size: 1em;
            background: linear-gradient(135deg, #8D4500, #D2691E);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(139, 69, 19, 0.25);
            touch-action: manipulation;
        }
        
        .restart-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(139, 69, 19, 0.3);
        }
        
        .input-guide {
            margin: 4px 0;
            font-size: 0.7em;
            color: #8D4500;
            font-weight: 600;
            background: rgba(210, 105, 30, 0.1);
            padding: 3px 6px;
            border-radius: 8px;
            border: 1px solid rgba(210, 105, 30, 0.3);
        }
        
        .romaji-display {
            font-size: 1em;
            margin: 4px 0;
            font-weight: 600;
            color: #666;
            opacity: 0.8;
        }
        
        /* iPhone„Ç≠„Éº„Éú„Éº„Éâ - Ê≠£Á¢∫„Å™ÈÖçÁΩÆ */
        .japanese-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(208, 213, 221, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 8px 4px 20px 4px;
            z-index: 20;
            height: 280px;
            touch-action: manipulation;
        }
        
        .keyboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            padding: 0 8px;
        }
        
        .input-mode-switch {
            font-size: 0.7em;
            padding: 4px 10px;
            background: linear-gradient(135deg, #D2691E, #8D4500);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            touch-action: manipulation;
        }
        
        .input-mode-switch:active {
            transform: scale(0.95);
        }
        
        .keyboard-toggle {
            font-size: 0.7em;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.8);
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            touch-action: manipulation;
        }
        
        .keyboard-toggle:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .kana-keyboard {
            display: block;
        }
        
        .romaji-keyboard {
            display: none;
        }
        
        /* iPhone„Å®Âêå„Åò4√ó3ÈÖçÁΩÆ */
        .kana-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            height: 220px;
            padding: 10px;
        }
        
        /* iPhone„É©„Ç§„ÇØ„Å™„Ç≠„Éº„Éá„Ç∂„Ç§„É≥ */
        .kana-key {
            background: #ffffff;
            color: #000000;
            border: none;
            border-radius: 6px;
            font-size: 1.3em;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            touch-action: manipulation;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3), 0 2px 0 rgba(0, 0, 0, 0.15);
        }
        
        .kana-key:active {
            background: #d1d5db;
            transform: translateY(1px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.3), 0 1px 0 rgba(0, 0, 0, 0.15);
        }
        
        /* ÁâπÊÆä„Ç≠„Éº */
        .kana-key.special {
            background: #acb2b9;
            color: #000;
            font-size: 1em;
        }
        
        .kana-key.special:active {
            background: #9ca3af;
        }
        
        /* „Éï„É™„ÉÉ„ÇØÂÄôË£úË°®Á§∫ */
        .flick-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            border-radius: 8px;
            padding: 4px;
            font-size: 0.9em;
            z-index: 100;
            display: none;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }
        
        .flick-chars {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 2px;
            width: 80px;
            height: 80px;
        }
        
        .flick-char {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background: transparent;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }
        
        .flick-char.center {
            grid-column: 2;
            grid-row: 2;
        }
        
        .flick-char.up {
            grid-column: 2;
            grid-row: 1;
        }
        
        .flick-char.right {
            grid-column: 3;
            grid-row: 2;
        }
        
        .flick-char.down {
            grid-column: 2;
            grid-row: 3;
        }
        
        .flick-char.left {
            grid-column: 1;
            grid-row: 2;
        }
        
        .flick-char.active {
            background: #007AFF;
            color: white;
            transform: scale(1.2);
        }
        
        .effect-particles {
            position: fixed;
            pointer-events: none;
            z-index: 8;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .particle {
            position: absolute;
            font-size: 1.5em;
            animation: particleFloat 2s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            20% { transform: scale(1.2) rotate(90deg); opacity: 1; }
            100% { transform: scale(0.8) rotate(360deg) translateY(-120px); opacity: 0; }
        }
        
        .explosion-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            animation: explosionGrow 0.5s ease-out forwards;
            z-index: 7;
        }
        
        @keyframes explosionGrow {
            0% { transform: scale(0); opacity: 0.6; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="effect-particles" id="effectParticles"></div>
    <div class="container">
        <h1 class="title">üê± NEKOPON RENDA üê±</h1>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-label">‚è∞ TIME</div>
                <div class="stat-value" id="time">60</div>
            </div>
            <div class="stat">
                <div class="stat-label">‚ú® SCORE</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">üî• RATE</div>
                <div class="stat-value" id="accuracy">100%</div>
            </div>
        </div>
        
        <div id="menu">
            <div class="course-selection">
                <h2>üèÜ „Ç≥„Éº„Çπ„ÇíÈÅ∏„Çì„Åß„Å´„ÇÉ„Äú üèÜ</h2>
                <div class="course-buttons">
                    <button class="course-btn" onclick="startGame('easy')">
                        üêæ „Åã„Çì„Åü„Çì
                        <small>ÁõÆÊ®ô: 1000pt</small>
                    </button>
                    <button class="course-btn" onclick="startGame('normal')">
                        üê± „Åµ„Å§„ÅÜ
                        <small>ÁõÆÊ®ô: 2000pt</small>
                    </button>
                    <button class="course-btn" onclick="startGame('hard')">
                        üò∏ „ÇÄ„Åö„Åã„Åó„ÅÑ
                        <small>ÁõÆÊ®ô: 3500pt</small>
                    </button>
                    <button class="course-btn" onclick="startGame('expert')">
                        üëë „Å°„Çá„ÅÜ„ÇÄ„Åö„Åã„Åó„ÅÑ
                        <small>ÁõÆÊ®ô: 5000pt</small>
                    </button>
                </div>
            </div>
            <div class="input-guide">
                üí° Êó•Êú¨Ë™û„ÅßÂÖ•ÂäõÔºà„Éï„É™„ÉÉ„ÇØ/„Çø„ÉÉ„ÉóÂØæÂøúÔºâ
            </div>
        </div>
        
        <div class="game-area" id="game">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
            <div class="word-display" id="word"></div>
            <div class="romaji-display" id="romaji"></div>
            <div class="input-guide">
                „Å≤„Çâ„Åå„Å™„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </div>
        </div>
        
        <div class="combo-display" id="combo"></div>
        
        <div class="result-screen" id="result">
            <div class="result-title">üéä ÁµêÊûúÁô∫Ë°®„Å´„ÇÉ„ÄúÔºÅ üéä</div>
            <div id="result-text" style="font-size: 1em; line-height: 1.6; color: #8D4500; font-weight: 600;"></div>
            <button class="restart-btn" onclick="resetGame()">üê± „ÇÇ„ÅÜ‰∏ÄÂ∫¶„Å´„ÇÉ„Äú</button>
        </div>
    </div>
    
    <!-- iPhoneÊ≠£Á¢∫„Ç≠„Éº„Éú„Éº„ÉâÈÖçÁΩÆ -->
    <div class="japanese-keyboard" id="japaneseKeyboard">
        <div class="keyboard-controls">
            <button class="input-mode-switch" id="inputModeSwitch" onclick="toggleInputMode()">
                „Éï„É™„ÉÉ„ÇØ
            </button>
            <button class="keyboard-toggle" onclick="toggleKeyboardType()">
                „É≠„Éº„ÉûÂ≠ó
            </button>
        </div>
        
        <!-- „Åã„Å™„Ç≠„Éº„Éú„Éº„Éâ - iPhoneÈÖçÁΩÆÔºö4√ó3„Ç∞„É™„ÉÉ„Éâ -->
        <div class="kana-keyboard" id="kanaKeyboard">
            <div class="kana-grid">
                <!-- 1Ë°åÁõÆ -->
                <div class="kana-key" data-chars="„ÅÇ„ÅÑ„ÅÜ„Åà„Åä">„ÅÇ</div>
                <div class="kana-key" data-chars="„Åã„Åç„Åè„Åë„Åì">„Åã</div>
                <div class="kana-key" data-chars="„Åï„Åó„Åô„Åõ„Åù">„Åï</div>
                
                <!-- 2Ë°åÁõÆ -->
                <div class="kana-key" data-chars="„Åü„Å°„Å§„Å¶„Å®">„Åü</div>
                <div class="kana-key" data-chars="„Å™„Å´„Å¨„Å≠„ÅÆ">„Å™</div>
                <div class="kana-key" data-chars="„ÅØ„Å≤„Åµ„Å∏„Åª">„ÅØ</div>
                
                <!-- 3Ë°åÁõÆ -->
                <div class="kana-key" data-chars="„Åæ„Åø„ÇÄ„ÇÅ„ÇÇ">„Åæ</div>
                <div class="kana-key" data-chars="„ÇÑ„ÇÜ„Çà">„ÇÑ</div>
                <div class="kana-key" data-chars="„Çâ„Çä„Çã„Çå„Çç">„Çâ</div>
                
                <!-- 4Ë°åÁõÆ -->
                <div class="kana-key special" onclick="inputKana('backspace')">‚å´</div>
                <div class="kana-key special" data-chars="„Çè„Çí„Çì„Éº">„Çè„Éº</div>
                <div class="kana-key special" data-chars="„ÄÅ„ÄÇÔºüÔºÅ">„ÄÅ„ÄÇÔºüÔºÅ</div>
            </div>
        </div>
        
        <!-- „É≠„Éº„ÉûÂ≠ó„Ç≠„Éº„Éú„Éº„Éâ -->
        <div class="romaji-keyboard" id="romajiKeyboard">
            <div class="kana-grid">
                <!-- 1Ë°åÁõÆ -->
                <div class="kana-key" onclick="inputChar('a')">a</div>
                <div class="kana-key" onclick="inputChar('k')">k</div>
                <div class="kana-key" onclick="inputChar('s')">s</div>
                
                <!-- 2Ë°åÁõÆ -->
                <div class="kana-key" onclick="inputChar('t')">t</div>
                <div class="kana-key" onclick="inputChar('n')">n</div>
                <div class="kana-key" onclick="inputChar('h')">h</div>
                
                <!-- 3Ë°åÁõÆ -->
                <div class="kana-key" onclick="inputChar('m')">m</div>
                <div class="kana-key" onclick="inputChar('y')">y</div>
                <div class="kana-key" onclick="inputChar('r')">r</div>
                
                <!-- 4Ë°åÁõÆ -->
                <div class="kana-key special" onclick="inputChar('Backspace')">‚å´</div>
                <div class="kana-key" onclick="inputChar('w')">w</div>
                <div class="kana-key special" onclick="inputChar('.')">.</div>
            </div>
        </div>
    </div>
    
    <script>
        // „Éî„É≥„ÉÅ„Ç∫„Éº„É†ÁÑ°ÂäπÂåñ
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
        
        document.addEventListener('gesturechange', function (e) {
            e.preventDefault();
        });
        
        document.addEventListener('gestureend', function (e) {
            e.preventDefault();
        });
        
        // „ÉÄ„Éñ„É´„Çø„ÉÉ„Éó„Ç∫„Éº„É†ÁÑ°ÂäπÂåñ
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // „Ç≤„Éº„É†Áä∂ÊÖã
        let game = {
            active: false,
            course: '',
            words: [],
            currentWord: 0,
            currentChar: 0,
            currentInput: '',
            targetWord: '',
            score: 0,
            time: 60,
            correct: 0,
            total: 0,
            combo: 0,
            maxCombo: 0,
            timer: null,
            audioContext: null,
            inputMode: 'kana', // 'kana' or 'romaji'
            flickMode: true // „Éï„É™„ÉÉ„ÇØÂÖ•Âäõ„ÅÆON/OFF
        };
        
        // „Çø„ÉÉ„ÉóÂÖ•ÂäõÁÆ°ÁêÜ
        let tapData = {
            currentKey: null,
            tapCount: 0,
            tapTimer: null
        };
        
        // Êó•Â∏∏ÁöÑ„Å™ÂçòË™û„É™„Çπ„Éà
        const dailyWords = {
            easy: [
                '„ÅÇ„Åï', '„Å≤„Çã', '„Çà„Çã', '„ÅÇ„ÇÅ', '„Åã„Åú', '„Åù„Çâ', '„Åª„Åó', '„Å§„Åç', '„Å≤', '„Åø„Åö',
                '„ÇÑ„Åæ', '„ÅÜ„Åø', '„ÅÑ„Åà', '„Åø„Å°', '„ÅØ„Å™', '„Åç', '„Å®„Çä', '„ÅÑ„Å¨', '„Å≠„Åì', '„Åï„Åã„Å™'
            ],
            normal: [
                '„ÅÇ„Åï„Åî„ÅØ„Çì', '„Å≤„Çã„Åî„ÅØ„Çì', '„Å∞„Çì„Åî„ÅØ„Çì', '„Åå„Å£„Åì„ÅÜ', '„Å®„Åó„Çá„Åã„Çì', '„Å≥„Çá„ÅÜ„ÅÑ„Çì',
                '„Åì„ÅÜ„Åà„Çì', '„Åß„Çì„Åó„ÇÉ', '„Åò„Å©„ÅÜ„Åó„ÇÉ', '„Åã„ÅÑ„ÇÇ„ÅÆ', '„Çä„Çá„Åì„ÅÜ', '„Åó„ÇÖ„Åø'
            ],
            hard: [
                '„Åü„Çì„Åò„Çá„ÅÜ„Å≥', '„ÇØ„É™„Çπ„Éû„Çπ', '„Åä„Åó„Çá„ÅÜ„Åå„Å§', '„Ç≥„É≥„Éî„É•„Éº„Çø„Éº', '„Ç§„É≥„Çø„Éº„Éç„ÉÉ„Éà',
                '„Çπ„Éû„Éº„Éà„Éï„Ç©„É≥', '„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞', '„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥'
            ],
            expert: [
                '„Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´', '„Ç®„É≥„Çø„Éº„ÉÜ„Ç§„É≥„É°„É≥„Éà', '„Ç≥„Éü„É•„Éã„Ç±„Éº„Ç∑„Éß„É≥', '„Ç§„É≥„Éï„Ç©„É°„Éº„Ç∑„Éß„É≥',
                '„Ç¢„Éâ„Éü„Éã„Çπ„Éà„É¨„Éº„Ç∑„Éß„É≥', '„ÉÜ„ÇØ„Éé„É≠„Ç∏„Éº', '„Ç®„É≥„Éê„Ç§„É≠„É≥„É°„É≥„Éà'
            ]
        };
        
        // „É≠„Éº„ÉûÂ≠ó‚Üí„Å≤„Çâ„Åå„Å™Â§âÊèõ
        function toRomaji(hiragana) {
            let result = '';
            let i = 0;
            while (i < hiragana.length) {
                let char = hiragana[i];
                let nextChar = i + 1 < hiragana.length ? hiragana[i + 1] : '';
                let twoCharRomaji = convertTwoChar(char, nextChar);
                if (twoCharRomaji) {
                    result += twoCharRomaji;
                    i += 2;
                } else {
                    let oneCharRomaji = convertOneChar(char);
                    result += oneCharRomaji;
                    i += 1;
                }
            }
            return result;
        }
        
        function convertTwoChar(char1, char2) {
            const twoCharTable = {
                '„Åç„ÇÉ': 'kya', '„Åç„ÇÖ': 'kyu', '„Åç„Çá': 'kyo',
                '„Åé„ÇÉ': 'gya', '„Åé„ÇÖ': 'gyu', '„Åé„Çá': 'gyo',
                '„Åó„ÇÉ': 'sha', '„Åó„ÇÖ': 'shu', '„Åó„Çá': 'sho',
                '„Åò„ÇÉ': 'ja', '„Åò„ÇÖ': 'ju', '„Åò„Çá': 'jo',
                '„Å°„ÇÉ': 'cha', '„Å°„ÇÖ': 'chu', '„Å°„Çá': 'cho',
                '„Å´„ÇÉ': 'nya', '„Å´„ÇÖ': 'nyu', '„Å´„Çá': 'nyo',
                '„Å≤„ÇÉ': 'hya', '„Å≤„ÇÖ': 'hyu', '„Å≤„Çá': 'hyo',
                '„Å≥„ÇÉ': 'bya', '„Å≥„ÇÖ': 'byu', '„Å≥„Çá': 'byo',
                '„Å¥„ÇÉ': 'pya', '„Å¥„ÇÖ': 'pyu', '„Å¥„Çá': 'pyo',
                '„Åø„ÇÉ': 'mya', '„Åø„ÇÖ': 'myu', '„Åø„Çá': 'myo',
                '„Çä„ÇÉ': 'rya', '„Çä„ÇÖ': 'ryu', '„Çä„Çá': 'ryo'
            };
            return twoCharTable[char1 + char2] || null;
        }
        
        function convertOneChar(char) {
            const oneCharTable = {
                '„ÅÇ': 'a', '„ÅÑ': 'i', '„ÅÜ': 'u', '„Åà': 'e', '„Åä': 'o',
                '„Åã': 'ka', '„Åç': 'ki', '„Åè': 'ku', '„Åë': 'ke', '„Åì': 'ko',
                '„Åå': 'ga', '„Åé': 'gi', '„Åê': 'gu', '„Åí': 'ge', '„Åî': 'go',
                '„Åï': 'sa', '„Åó': 'shi', '„Åô': 'su', '„Åõ': 'se', '„Åù': 'so',
                '„Åñ': 'za', '„Åò': 'ji', '„Åö': 'zu', '„Åú': 'ze', '„Åû': 'zo',
                '„Åü': 'ta', '„Å°': 'chi', '„Å§': 'tsu', '„Å¶': 'te', '„Å®': 'to',
                '„Å†': 'da', '„Å¢': 'di', '„Å•': 'du', '„Åß': 'de', '„Å©': 'do',
                '„Å™': 'na', '„Å´': 'ni', '„Å¨': 'nu', '„Å≠': 'ne', '„ÅÆ': 'no',
                '„ÅØ': 'ha', '„Å≤': 'hi', '„Åµ': 'fu', '„Å∏': 'he', '„Åª': 'ho',
                '„Å∞': 'ba', '„Å≥': 'bi', '„Å∂': 'bu', '„Åπ': 'be', '„Åº': 'bo',
                '„Å±': 'pa', '„Å¥': 'pi', '„Å∑': 'pu', '„Å∫': 'pe', '„ÅΩ': 'po',
                '„Åæ': 'ma', '„Åø': 'mi', '„ÇÄ': 'mu', '„ÇÅ': 'me', '„ÇÇ': 'mo',
                '„ÇÑ': 'ya', '„ÇÜ': 'yu', '„Çà': 'yo',
                '„Çâ': 'ra', '„Çä': 'ri', '„Çã': 'ru', '„Çå': 're', '„Çç': 'ro',
                '„Çè': 'wa', '„Çê': 'wi', '„Çë': 'we', '„Çí': 'wo', '„Çì': 'n',
                '„Éº': '-', '„Å£': '', '„ÇÉ': 'ya', '„ÇÖ': 'yu', '„Çá': 'yo'
            };
            return oneCharTable[char] || char;
        }
        
        // Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†
        function initAudioContext() {
            try {
                if (!game.audioContext || game.audioContext.state === 'closed') {
                    game.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (game.audioContext.state === 'suspended') {
                    game.audioContext.resume();
                }
                return game.audioContext;
            } catch (e) {
                return null;
            }
        }
        
        function playNekoSound(type = 'success', intensity = 1) {
            try {
                const audioContext = initAudioContext();
                if (!audioContext) return;
                
                if (type === 'success') {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.setValueAtTime(660, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.1 * intensity, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                    osc.start(audioContext.currentTime);
                    osc.stop(audioContext.currentTime + 0.2);
                } else if (type === 'complete') {
                    const frequencies = [523, 659, 784];
                    frequencies.forEach((freq, i) => {
                        setTimeout(() => {
                            try {
                                const osc = audioContext.createOscillator();
                                const gain = audioContext.createGain();
                                osc.connect(gain);
                                gain.connect(audioContext.destination);
                                osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                                gain.gain.setValueAtTime(0.08 * intensity, audioContext.currentTime);
                                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                                osc.start(audioContext.currentTime);
                                osc.stop(audioContext.currentTime + 0.3);
                            } catch (e) {}
                        }, i * 80);
                    });
                }
            } catch (e) {
                game.audioContext = null;
            }
        }
        
        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà
        function createParticleExplosion(x, y, type = 'normal') {
            const particles = ['üê±', '‚ú®', 'üåü', 'üí´'];
            const colors = ['#8D4500', '#D2691E', '#FF8C00'];
            let particleCount = type === 'big' ? 6 : 3;
            let explosionColor = colors[Math.floor(Math.random() * colors.length)];
            
            const explosion = document.createElement('div');
            explosion.className = 'explosion-effect';
            explosion.style.left = (x - 30) + 'px';
            explosion.style.top = (y - 30) + 'px';
            explosion.style.background = `radial-gradient(circle, ${explosionColor}30, transparent)`;
            document.getElementById('effectParticles').appendChild(explosion);
            
            setTimeout(() => {
                if (explosion.parentNode) {
                    explosion.parentNode.removeChild(explosion);
                }
            }, 500);
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                
                const angle = (360 / particleCount) * i;
                const distance = type === 'big' ? 80 : 50;
                const radian = (angle * Math.PI) / 180;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.transform = `translate(${Math.cos(radian) * distance}px, ${Math.sin(radian) * distance}px)`;
                
                document.getElementById('effectParticles').appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 2000);
            }
        }
        
        // „Ç≠„Éº„Éú„Éº„ÉâÂàá„ÇäÊõø„Åà
        function toggleInputMode() {
            game.flickMode = !game.flickMode;
            const switchBtn = document.getElementById('inputModeSwitch');
            switchBtn.textContent = game.flickMode ? '„Éï„É™„ÉÉ„ÇØ' : '„Çø„ÉÉ„Éó';
        }
        
        function toggleKeyboardType() {
            const kanaKeyboard = document.getElementById('kanaKeyboard');
            const romajiKeyboard = document.getElementById('romajiKeyboard');
            
            if (game.inputMode === 'kana') {
                game.inputMode = 'romaji';
                kanaKeyboard.style.display = 'none';
                romajiKeyboard.style.display = 'block';
            } else {
                game.inputMode = 'kana';
                kanaKeyboard.style.display = 'block';
                romajiKeyboard.style.display = 'none';
            }
        }
        
        // „Éï„É™„ÉÉ„ÇØÂÖ•ÂäõÂá¶ÁêÜ
        let touchData = {
            startX: 0,
            startY: 0,
            currentKey: null,
            isFlicking: false
        };
        
        function setupFlickInput() {
            const kanaKeys = document.querySelectorAll('.kana-key[data-chars]');
            
            kanaKeys.forEach(key => {
                // „Çø„ÉÉ„ÉÅÈñãÂßã
                key.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    touchData.startX = touch.clientX;
                    touchData.startY = touch.clientY;
                    touchData.currentKey = key;
                    touchData.isFlicking = false;
                    
                    if (game.flickMode) {
                        showFlickPopup(key);
                    }
                });
                
                // „Çø„ÉÉ„ÉÅÁßªÂãï
                key.addEventListener('touchmove', (e) => {
                    if (!touchData.currentKey || !game.flickMode) return;
                    e.preventDefault();
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - touchData.startX;
                    const deltaY = touch.clientY - touchData.startY;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    
                    if (distance > 20) {
                        touchData.isFlicking = true;
                        updateFlickPopup(key, deltaX, deltaY);
                    }
                });
                
                // „Çø„ÉÉ„ÉÅÁµÇ‰∫Ü
                key.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (!touchData.currentKey) return;
                    
                    let inputChar;
                    if (game.flickMode && touchData.isFlicking) {
                        // „Éï„É™„ÉÉ„ÇØÂÖ•Âäõ
                        const touch = e.changedTouches[0];
                        const deltaX = touch.clientX - touchData.startX;
                        const deltaY = touch.clientY - touchData.startY;
                        inputChar = getFlickChar(key, deltaX, deltaY);
                    } else {
                        // „Çø„ÉÉ„ÉóÂÖ•ÂäõÔºàÈÄ£Á∂ö„Çø„ÉÉ„ÉóÊñπÂºèÔºâ
                        handleTapInput(key);
                        hideFlickPopup();
                        touchData.currentKey = null;
                        return;
                    }
                    
                    if (inputChar) {
                        inputKana(inputChar);
                    }
                    
                    hideFlickPopup();
                    touchData.currentKey = null;
                    touchData.isFlicking = false;
                });
                
                // „ÇØ„É™„ÉÉ„ÇØÔºàPCÁî®Ôºâ
                key.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (touchData.currentKey) return; // „Çø„ÉÉ„ÉÅÂá¶ÁêÜ‰∏≠„ÅØÁÑ°Ë¶ñ
                    
                    if (game.flickMode) {
                        const chars = key.dataset.chars;
                        if (chars) {
                            inputKana(chars[0]); // ÊúÄÂàù„ÅÆÊñáÂ≠ó
                        }
                    } else {
                        handleTapInput(key);
                    }
                });
            });
        }
        
        // „Çø„ÉÉ„ÉóÂÖ•ÂäõÂá¶ÁêÜÔºàÈÄ£Á∂ö„Çø„ÉÉ„ÉóÊñπÂºèÔºâ
        function handleTapInput(key) {
            const chars = key.dataset.chars;
            if (!chars) return;
            
            // Âêå„Åò„Ç≠„Éº„ÅÆÈÄ£Á∂ö„Çø„ÉÉ„Éó
            if (tapData.currentKey === key) {
                tapData.tapCount = (tapData.tapCount + 1) % chars.length;
            } else {
                // Êñ∞„Åó„ÅÑ„Ç≠„Éº
                if (tapData.currentKey && tapData.tapTimer) {
                    // Ââç„ÅÆ„Ç≠„Éº„ÅÆÊñáÂ≠ó„ÇíÁ¢∫ÂÆö
                    const prevChars = tapData.currentKey.dataset.chars;
                    if (prevChars) {
                        inputKana(prevChars[tapData.tapCount]);
                    }
                }
                tapData.currentKey = key;
                tapData.tapCount = 0;
            }
            
            // „Çø„Ç§„Éû„Éº„Çí„É™„Çª„ÉÉ„Éà
            if (tapData.tapTimer) {
                clearTimeout(tapData.tapTimer);
            }
            
            // ÁèæÂú®„ÅÆÊñáÂ≠ó„ÇíË°®Á§∫Ôºà‰ªÆÔºâ
            console.log('„Çø„ÉÉ„Éó:', chars[tapData.tapCount]);
            
            // 1ÁßíÂæå„Å´ÊñáÂ≠ó„ÇíÁ¢∫ÂÆö
            tapData.tapTimer = setTimeout(() => {
                if (tapData.currentKey) {
                    const currentChars = tapData.currentKey.dataset.chars;
                    if (currentChars) {
                        inputKana(currentChars[tapData.tapCount]);
                    }
                    tapData.currentKey = null;
                    tapData.tapCount = 0;
                }
            }, 1000);
        }
        
        function showFlickPopup(key) {
            const popup = document.createElement('div');
            popup.className = 'flick-popup';
            popup.id = 'flickPopup';
            
            const chars = key.dataset.chars;
            if (!chars) return;
            
            // „Éï„É™„ÉÉ„ÇØÊñπÂêë„Å´ÊñáÂ≠ó„ÇíÈÖçÁΩÆ
            let charsHtml = '';
            charsHtml += `<div class="flick-char center active">${chars[0] || ''}</div>`; // ‰∏≠Â§Æ
            charsHtml += `<div class="flick-char up">${chars[2] || ''}</div>`; // ‰∏ä
            charsHtml += `<div class="flick-char right">${chars[3] || ''}</div>`; // Âè≥
            charsHtml += `<div class="flick-char down">${chars[4] || ''}</div>`; // ‰∏ã
            charsHtml += `<div class="flick-char left">${chars[1] || ''}</div>`; // Â∑¶
            
            popup.innerHTML = `<div class="flick-chars">${charsHtml}</div>`;
            key.appendChild(popup);
            popup.style.display = 'block';
        }
        
        function updateFlickPopup(key, deltaX, deltaY) {
            const popup = document.getElementById('flickPopup');
            if (!popup) return;
            
            const chars = popup.querySelectorAll('.flick-char');
            
            // „Éï„É™„ÉÉ„ÇØÊñπÂêë„ÇíÂà§ÂÆö
            let direction = 'center';
            const threshold = 30;
            
            if (Math.abs(deltaX) > threshold || Math.abs(deltaY) > threshold) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    direction = deltaX > 0 ? 'right' : 'left';
                } else {
                    direction = deltaY < 0 ? 'up' : 'down';
                }
            }
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™ÊñáÂ≠ó„ÇíÊõ¥Êñ∞
            chars.forEach(char => {
                char.classList.remove('active');
                if (char.classList.contains(direction)) {
                    char.classList.add('active');
                }
            });
        }
        
        function getFlickChar(key, deltaX, deltaY) {
            const chars = key.dataset.chars;
            if (!chars) return null;
            
            let direction = 0; // 0:‰∏≠Â§Æ, 1:Â∑¶, 2:‰∏ä, 3:Âè≥, 4:‰∏ã
            const threshold = 30;
            
            if (Math.abs(deltaX) > threshold || Math.abs(deltaY) > threshold) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    direction = deltaX > 0 ? 3 : 1; // Âè≥ or Â∑¶
                } else {
                    direction = deltaY < 0 ? 2 : 4; // ‰∏ä or ‰∏ã
                }
            }
            
            return chars[direction] || chars[0];
        }
        
        function hideFlickPopup() {
            const popup = document.getElementById('flickPopup');
            if (popup) {
                popup.remove();
            }
        }
        
        // „Ç≤„Éº„É†ÈñãÂßã
        function startGame(course) {
            console.log('NEKOPON RENDAÈñãÂßã:', course);
            initAudioContext();
            
            game.active = true;
            game.course = course;
            game.words = [...dailyWords[course]];
            game.currentWord = 0;
            game.currentChar = 0;
            game.currentInput = '';
            game.score = 0;
            game.time = 60;
            game.correct = 0;
            game.total = 0;
            game.combo = 0;
            game.maxCombo = 0;
            
            // „Ç∑„É£„ÉÉ„Éï„É´
            for (let i = game.words.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [game.words[i], game.words[j]] = [game.words[j], game.words[i]];
            }
            
            game.targetWord = game.words[game.currentWord];
            
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            
            updateDisplay();
            startTimer();
            playNekoSound('complete', 1.2);
        }
        
        function updateDisplay() {
            const targetWord = game.targetWord;
            const romajiWord = toRomaji(targetWord);
            
            // Êó•Êú¨Ë™ûË°®Á§∫
            let japaneseHtml = '';
            for (let i = 0; i < targetWord.length; i++) {
                if (i < game.currentChar) {
                    japaneseHtml += `<span class="typed">${targetWord[i]}</span>`;
                } else if (i === game.currentChar) {
                    japaneseHtml += `<span class="current">${targetWord[i]}</span>`;
                } else {
                    japaneseHtml += `<span class="remaining">${targetWord[i]}</span>`;
                }
            }
            document.getElementById('word').innerHTML = japaneseHtml;
            
            // „É≠„Éº„ÉûÂ≠óË°®Á§∫
            document.getElementById('romaji').textContent = romajiWord;
            
            document.getElementById('score').textContent = game.score;
            const accuracy = game.total > 0 ? Math.round((game.correct / game.total) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº
            const progress = (game.currentChar / targetWord.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }
        
        function updateCombo() {
            const comboElement = document.getElementById('combo');
            if (game.combo > 4) {
                comboElement.innerHTML = `<div class="combo-text">${game.combo} COMBO!</div>`;
                game.maxCombo = Math.max(game.maxCombo, game.combo);
            } else {
                comboElement.innerHTML = '';
            }
        }
        
        function startTimer() {
            if (game.timer) clearInterval(game.timer);
            
            game.timer = setInterval(() => {
                game.time--;
                document.getElementById('time').textContent = game.time;
                
                if (game.time <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        function endGame() {
            game.active = false;
            if (game.timer) {
                clearInterval(game.timer);
                game.timer = null;
            }
            
            // „Éï„Ç£„Éä„Éº„É¨„Ç®„Éï„Çß„ÇØ„Éà
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    createParticleExplosion(
                        Math.random() * window.innerWidth,
                        Math.random() * (window.innerHeight - 280),
                        'big'
                    );
                }, i * 150);
            }
            
            playNekoSound('complete', 2);
            setTimeout(showResults, 1500);
        }
        
        function showResults() {
            const targets = {
                easy: 1000,
                normal: 2000,
                hard: 3500,
                expert: 5000
            };
            const target = targets[game.course];
            const accuracy = game.total > 0 ? Math.round((game.correct / game.total) * 100) : 100;
            
            let rank = '';
            if (game.score >= target * 1.5) {
                rank = 'üëë NEKOPON ‰ºùË™¨ üëë';
            } else if (game.score >= target) {
                rank = 'üåü ÁõÆÊ®ôÈÅîÊàê„Å´„ÇÉ„ÄúÔºÅ üåü';
            } else if (game.score >= target * 0.8) {
                rank = 'üê± „ÇÇ„ÅÜÂ∞ë„Åó„Å´„ÇÉ„Äú üê±';
            } else {
                rank = 'üí™ Á∑¥Áøí„Åô„Çã„Å´„ÇÉ„Äú üí™';
            }
            
            document.getElementById('result-text').innerHTML = `
                <div style="font-size: 1.2em; margin: 15px 0;">${rank}</div>
                <div style="margin: 10px 0;"><strong>‚ú® „Çπ„Ç≥„Ç¢:</strong> ${game.score} / ${target}</div>
                <div style="margin: 10px 0;"><strong>üî• Ê≠£Á¢∫Áéá:</strong> ${accuracy}%</div>
                <div style="margin: 10px 0;"><strong>üèÜ ÊúÄÂ§ß„Ç≥„É≥„Éú:</strong> ${game.maxCombo}Âõû</div>
                <div style="margin: 10px 0;"><strong>üíï ÂÖ•ÂäõÊñáÂ≠óÊï∞:</strong> ${game.correct}ÊñáÂ≠ó</div>
            `;
            
            document.getElementById('game').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            playNekoSound('complete', 1.5);
        }
        
        function resetGame() {
            document.getElementById('result').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
            document.getElementById('time').textContent = '60';
            document.getElementById('score').textContent = '0';
            document.getElementById('accuracy').textContent = '100%';
            document.getElementById('combo').innerHTML = '';
            document.getElementById('progress').style.width = '0%';
            
            if (game.timer) {
                clearInterval(game.timer);
                game.timer = null;
            }
        }
        
        // „Åã„Å™ÊñáÂ≠óÂÖ•ÂäõÂá¶ÁêÜ
        function inputKana(char) {
            if (!game.active) return;
            
            if (char === 'backspace') {
                if (game.currentInput.length > 0) {
                    game.currentInput = game.currentInput.slice(0, -1);
                    game.currentChar = game.currentInput.length;
                }
                updateDisplay();
                return;
            }
            
            if (char === 'enter' || char === ' ') return;
            
            game.total++;
            game.currentInput += char;
            
            console.log('„Åã„Å™ÂÖ•Âäõ:', char, 'ÁèæÂú®„ÅÆÂÖ•Âäõ:', game.currentInput, 'ÁõÆÊ®ô:', game.targetWord);
            
            if (game.targetWord.startsWith(game.currentInput)) {
                // Ê≠£Ëß£
                game.correct++;
                game.currentChar = game.currentInput.length;
                game.combo++;
                
                // „Çπ„Ç≥„Ç¢Ë®àÁÆó
                let baseScore = 15;
                let comboBonus = Math.floor(game.combo / 3) * 8;
                let timeBonus = game.time > 40 ? 7 : 0;
                game.score += baseScore + comboBonus + timeBonus;
                
                playNekoSound('success', 1);
                updateCombo();
                
                // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà
                createParticleExplosion(
                    Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1,
                    Math.random() * (window.innerHeight - 280) * 0.6
                );
                
                // ÂçòË™ûÂÆåÊàê„ÉÅ„Çß„ÉÉ„ÇØ
                if (game.currentInput === game.targetWord) {
                    // ÂçòË™ûÂÆåÊàê
                    game.score += 100;
                    game.combo += 10;
                    game.currentWord = (game.currentWord + 1) % game.words.length;
                    game.currentChar = 0;
                    game.currentInput = '';
                    
                    if (game.currentWord === 0) {
                        // ÂÖ®ÂçòË™ûÂÆå‰∫Ü„ÄÅ„Ç∑„É£„ÉÉ„Éï„É´
                        for (let i = game.words.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [game.words[i], game.words[j]] = [game.words[j], game.words[i]];
                        }
                    }
                    
                    game.targetWord = game.words[game.currentWord];
                    console.log('Êñ∞„Åó„ÅÑÂçòË™û:', game.targetWord);
                    
                    // ÂçòË™ûÂÆåÊàê„Ç®„Éï„Çß„ÇØ„Éà
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            createParticleExplosion(
                                Math.random() * window.innerWidth,
                                Math.random() * (window.innerHeight - 280) * 0.8,
                                'big'
                            );
                        }, i * 100);
                    }
                    
                    playNekoSound('complete', 1.3);
                }
            } else {
                // ‰∏çÊ≠£Ëß£
                game.combo = 0;
                game.currentInput = ''; // „É™„Çª„ÉÉ„Éà
                game.currentChar = 0;
                updateCombo();
            }
            
            updateDisplay();
        }
        
        // „É≠„Éº„ÉûÂ≠óÂÖ•ÂäõÂá¶ÁêÜ
        function inputChar(char) {
            if (char === 'Backspace') {
                if (game.currentInput.length > 0) {
                    game.currentInput = game.currentInput.slice(0, -1);
                    game.currentChar = game.currentInput.length;
                }
                updateDisplay();
                return;
            }
            
            if (game.inputMode === 'romaji') {
                processInput(char);
            }
        }
        
        function processInput(inputChar) {
            if (!game.active) return;
            
            if (game.audioContext && game.audioContext.state === 'suspended') {
                game.audioContext.resume();
            }
            
            game.total++;
            game.currentInput += inputChar;
            
            const targetRomaji = toRomaji(game.targetWord);
            console.log('„É≠„Éº„ÉûÂ≠óÂÖ•Âäõ:', inputChar, 'ÁèæÂú®:', game.currentInput, 'ÁõÆÊ®ô:', targetRomaji);
            
            if (targetRomaji.startsWith(game.currentInput)) {
                game.correct++;
                game.currentChar = game.currentInput.length;
                game.combo++;
                
                let baseScore = 15;
                let comboBonus = Math.floor(game.combo / 3) * 8;
                let timeBonus = game.time > 40 ? 7 : 0;
                game.score += baseScore + comboBonus + timeBonus;
                
                playNekoSound('success', 1);
                updateCombo();
                
                createParticleExplosion(
                    Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1,
                    Math.random() * (window.innerHeight - 280) * 0.6
                );
                
                if (game.currentInput === targetRomaji) {
                    game.score += 100;
                    game.combo += 10;
                    game.currentWord = (game.currentWord + 1) % game.words.length;
                    game.currentChar = 0;
                    game.currentInput = '';
                    
                    if (game.currentWord === 0) {
                        for (let i = game.words.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [game.words[i], game.words[j]] = [game.words[j], game.words[i]];
                        }
                    }
                    
                    game.targetWord = game.words[game.currentWord];
                    
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            createParticleExplosion(
                                Math.random() * window.innerWidth,
                                Math.random() * (window.innerHeight - 280) * 0.8,
                                'big'
                            );
                        }, i * 100);
                    }
                    
                    playNekoSound('complete', 1.3);
                }
            } else {
                game.combo = 0;
                game.currentInput = '';
                game.currentChar = 0;
                updateCombo();
            }
            
            updateDisplay();
        }
        
        // PC„Ç≠„Éº„Éú„Éº„Éâ„Ç§„Éô„É≥„Éà
        document.addEventListener('keydown', function(event) {
            if (event.key.length === 1 && event.key.match(/[a-z]/i)) {
                event.preventDefault();
                if (game.inputMode === 'romaji') {
                    processInput(event.key.toLowerCase());
                }
            }
        });
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            setupFlickInput();
        });
        
        document.addEventListener('click', initAudioContext, { once: true });
        
        console.log('üê± NEKOPON RENDA ÂÆåÂÖ®iPhone‰ªïÊßòÁâà ÂàùÊúüÂåñÂÆå‰∫ÜÔºÅ üê±');
    </script>
</body>
</html>