<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ğŸ± NEKOPON RENDA ğŸ±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background: #ffffff;
            color: #5D4037;
            height: 100vh;
            position: relative;
            font-size: 14px;
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
            overflow-y: auto;
        }
        
        /* ã‚·ãƒ³ãƒ—ãƒ«èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle at 30% 30%, rgba(139, 69, 19, 0.05) 2px, transparent 2px);
            background-size: 100px 100px;
            z-index: 0;
        }
        
        .container {
            position: relative;
            width: 100vw;
            min-height: calc(100vh - 280px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            z-index: 10;
            padding: 10px;
            padding-bottom: 300px;
        }
        
        .title {
            font-size: 1.4em;
            margin: 5px 0;
            background: linear-gradient(45deg, #8D4500, #D2691E, #FF8C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .stats {
            display: flex;
            gap: 8px;
            margin: 8px 0;
            font-size: 0.8em;
            z-index: 10;
        }
        
        .stat {
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #FFF8DC 100%);
            padding: 4px 8px;
            border-radius: 8px;
            border: 1px solid #D2691E;
            box-shadow: 0 2px 8px rgba(210, 105, 30, 0.15);
            min-width: 45px;
        }
        
        .stat-label {
            font-size: 0.7em;
            opacity: 0.8;
            font-weight: 600;
            color: #5D4037;
        }
        
        .stat-value {
            font-weight: 700;
            color: #8D4500;
            font-size: 1em;
            margin-top: 1px;
        }
        
        .course-selection {
            margin: 8px 0;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-width: 350px;
            width: 100%;
        }
        
        .course-selection h2 {
            margin: 8px 0;
            color: #8D4500;
            font-size: 0.9em;
            font-weight: 700;
            text-align: center;
        }
        
        .course-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }
        
        .course-btn {
            padding: 12px 20px;
            font-size: 0.85em;
            background: linear-gradient(135deg, #D2691E, #8D4500);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(139, 69, 19, 0.25);
            text-align: center;
            width: 100%;
            touch-action: manipulation;
        }
        
        .course-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(139, 69, 19, 0.3);
            background: linear-gradient(135deg, #FF8C00, #D2691E);
        }
        
        .course-btn small {
            display: block;
            font-size: 0.8em;
            opacity: 0.9;
            margin-top: 2px;
        }
        
        .game-area {
            display: none;
            text-align: center;
            z-index: 10;
            width: 95%;
            max-width: 600px;
            flex: 1;
            flex-direction: column;
            min-height: calc(100vh - 280px);
        }
        
        .word-display {
            font-size: 1.8em;
            margin: 8px 0;
            font-weight: 700;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 0.1em;
            background: linear-gradient(135deg, #ffffff 0%, #FFF8DC 100%);
            border-radius: 15px;
            padding: 12px;
            border: 2px solid #D2691E;
            box-shadow: 0 4px 15px rgba(210, 105, 30, 0.15);
        }
        
        .typed {
            color: #2E7D32;
            text-shadow: 0 0 10px rgba(46, 125, 50, 0.4);
            animation: typedPop 0.3s ease;
        }
        
        @keyframes typedPop {
            0% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .current {
            color: #8D4500;
            background: rgba(139, 69, 19, 0.15);
            padding: 2px 8px;
            border-radius: 8px;
            text-shadow: 0 0 15px rgba(139, 69, 19, 0.6);
            animation: currentBlink 1s ease-in-out infinite alternate;
        }
        
        @keyframes currentBlink {
            0% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .remaining {
            color: #999;
            opacity: 0.6;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
            border: 1px solid #D2691E;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFE0B2, #D2691E, #8D4500);
            width: 0%;
            transition: width 0.4s ease;
        }
        
        .combo-display {
            position: absolute;
            top: 8%;
            right: 5%;
            font-size: 0.9em;
            font-weight: 700;
            z-index: 15;
        }
        
        .combo-text {
            color: #FF8C00;
            text-shadow: 0 0 15px rgba(255, 140, 0, 0.8);
            animation: comboShine 0.6s ease-in-out infinite alternate;
        }
        
        @keyframes comboShine {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        .result-screen {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffffff 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid #D2691E;
            text-align: center;
            z-index: 25;
            box-shadow: 0 10px 30px rgba(210, 105, 30, 0.25);
            min-width: 300px;
            max-width: 90vw;
        }
        
        .result-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #8D4500, #D2691E, #FF8C00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .restart-btn {
            padding: 10px 20px;
            font-size: 1em;
            background: linear-gradient(135deg, #8D4500, #D2691E);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Nunito', sans-serif;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(139, 69, 19, 0.25);
            touch-action: manipulation;
        }
        
        .restart-btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(139, 69, 19, 0.3);
        }
        
        .input-guide {
            margin: 4px 0;
            font-size: 0.7em;
            color: #8D4500;
            font-weight: 600;
            background: rgba(210, 105, 30, 0.1);
            padding: 3px 6px;
            border-radius: 8px;
            border: 1px solid rgba(210, 105, 30, 0.3);
        }
        
        .romaji-display {
            font-size: 1em;
            margin: 4px 0;
            font-weight: 600;
            color: #666;
            opacity: 0.8;
        }
        
        /* iPhoneã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ - æ­£æ–¹å½¢ãƒœã‚¿ãƒ³ */
        .japanese-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(208, 213, 221, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 8px 4px 20px 4px;
            z-index: 20;
            height: 280px;
            touch-action: manipulation;
        }
        
        .keyboard-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 6px;
            padding: 0 8px;
        }
        
        .input-mode-switch {
            font-size: 0.7em;
            padding: 4px 10px;
            background: linear-gradient(135deg, #D2691E, #8D4500);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            touch-action: manipulation;
        }
        
        .input-mode-switch:active {
            transform: scale(0.95);
        }
        
        /* ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ - 5åˆ—é…ç½®ï¼ˆå·¦å³ã«ã‚¤ãƒ©ã‚¹ãƒˆï¼‰ */
        .kana-grid {
            display: grid;
            grid-template-columns: 60px 1fr 1fr 1fr 60px;
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            height: 220px;
            padding: 10px;
            align-items: center;
        }
        
        /* è£…é£¾ã‚¨ãƒªã‚¢ */
        .decoration-left, .decoration-right {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 1.5em;
            color: #D2691E;
            opacity: 0.6;
        }
        
        .decoration-left {
            grid-column: 1;
            grid-row: 1 / -1;
        }
        
        .decoration-right {
            grid-column: 5;
            grid-row: 1 / -1;
        }
        
        /* æ­£æ–¹å½¢ã‚­ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .kana-key {
            background: #ffffff;
            color: #000000;
            border: none;
            border-radius: 6px;
            font-size: 1.2em;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            touch-action: manipulation;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.3), 0 2px 0 rgba(0, 0, 0, 0.15);
            aspect-ratio: 1;
            width: 100%;
        }
        
        .kana-key:active {
            background: #d1d5db;
            transform: translateY(1px);
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.3), 0 1px 0 rgba(0, 0, 0, 0.15);
        }
        
        /* ç‰¹æ®Šã‚­ãƒ¼ */
        .kana-key.special {
            background: #acb2b9;
            color: #000;
            font-size: 0.9em;
        }
        
        .kana-key.special:active {
            background: #9ca3af;
        }
        
        /* ã‚­ãƒ¼é…ç½® */
        .key-a { grid-column: 2; grid-row: 1; }
        .key-ka { grid-column: 3; grid-row: 1; }
        .key-sa { grid-column: 4; grid-row: 1; }
        .key-ta { grid-column: 2; grid-row: 2; }
        .key-na { grid-column: 3; grid-row: 2; }
        .key-ha { grid-column: 4; grid-row: 2; }
        .key-ma { grid-column: 2; grid-row: 3; }
        .key-ya { grid-column: 3; grid-row: 3; }
        .key-ra { grid-column: 4; grid-row: 3; }
        .key-backspace { grid-column: 2; grid-row: 4; }
        .key-dakuten { grid-column: 2; grid-row: 4; }
        .key-wa { grid-column: 3; grid-row: 4; }
        .key-punct { grid-column: 4; grid-row: 4; }
        
        /* ãƒ•ãƒªãƒƒã‚¯å€™è£œè¡¨ç¤º */
        .flick-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            border-radius: 8px;
            padding: 4px;
            font-size: 0.9em;
            z-index: 100;
            display: none;
            white-space: nowrap;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 5px;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }
        
        .flick-chars {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 2px;
            width: 80px;
            height: 80px;
        }
        
        .flick-char {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background: transparent;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }
        
        .flick-char.center {
            grid-column: 2;
            grid-row: 2;
        }
        
        .flick-char.up {
            grid-column: 2;
            grid-row: 1;
        }
        
        .flick-char.right {
            grid-column: 3;
            grid-row: 2;
        }
        
        .flick-char.down {
            grid-column: 2;
            grid-row: 3;
        }
        
        .flick-char.left {
            grid-column: 1;
            grid-row: 2;
        }
        
        .flick-char.active {
            background: #007AFF;
            color: white;
            transform: scale(1.2);
        }
        
        .effect-particles {
            position: fixed;
            pointer-events: none;
            z-index: 8;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .particle {
            position: absolute;
            font-size: 1.5em;
            animation: particleFloat 2s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            20% { transform: scale(1.2) rotate(90deg); opacity: 1; }
            100% { transform: scale(0.8) rotate(360deg) translateY(-120px); opacity: 0; }
        }
        
        .explosion-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            animation: explosionGrow 0.5s ease-out forwards;
            z-index: 7;
        }
        
        @keyframes explosionGrow {
            0% { transform: scale(0); opacity: 0.6; }
            100% { transform: scale(2); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="effect-particles" id="effectParticles"></div>
    <div class="container">
        <h1 class="title">ğŸ± NEKOPON RENDA ğŸ±</h1>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-label">â° TIME</div>
                <div class="stat-value" id="time">60</div>
            </div>
            <div class="stat">
                <div class="stat-label">âœ¨ SCORE</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">ğŸ”¥ RATE</div>
                <div class="stat-value" id="accuracy">100%</div>
            </div>
        </div>
        
        <div id="menu">
            <div class="course-selection">
                <h2>ğŸ† ã‚³ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ã«ã‚ƒã€œ ğŸ†</h2>
                <div class="course-buttons">
                    <button class="course-btn" onclick="startGame('easy')">
                        ğŸ¾ ã‹ã‚“ãŸã‚“
                        <small>ç›®æ¨™: 1000pt</small>
                    </button>
                    <button class="course-btn" onclick="startGame('normal')">
                        ğŸ± ãµã¤ã†
                        <small>ç›®æ¨™: 2000pt</small>
                    </button>
                    <button class="course-btn" onclick="startGame('hard')">
                        ğŸ˜¸ ã‚€ãšã‹ã—ã„
                        <small>ç›®æ¨™: 3500pt</small>
                    </button>
                    <button class="course-btn" onclick="startGame('expert')">
                        ğŸ‘‘ ã¡ã‚‡ã†ã‚€ãšã‹ã—ã„
                        <small>ç›®æ¨™: 5000pt</small>
                    </button>
                </div>
            </div>
            <div class="input-guide">
                ğŸ’¡ æ—¥æœ¬èªã§å…¥åŠ›ï¼ˆãƒ•ãƒªãƒƒã‚¯/ã‚±ãƒ¼ã‚¿ã‚¤å…¥åŠ›å¯¾å¿œï¼‰
            </div>
        </div>
        
        <div class="game-area" id="game">
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
            <div class="word-display" id="word"></div>
            <div class="romaji-display" id="romaji"></div>
            <div class="input-guide">
                ã²ã‚‰ãŒãªã§å…¥åŠ›ã—ã¦ãã ã•ã„
            </div>
        </div>
        
        <div class="combo-display" id="combo"></div>
        
        <div class="result-screen" id="result">
            <div class="result-title">ğŸŠ çµæœç™ºè¡¨ã«ã‚ƒã€œï¼ ğŸŠ</div>
            <div id="result-text" style="font-size: 1em; line-height: 1.6; color: #8D4500; font-weight: 600;"></div>
            <button class="restart-btn" onclick="resetGame()">ğŸ± ã‚‚ã†ä¸€åº¦ã«ã‚ƒã€œ</button>
        </div>
    </div>
    
    <!-- ã‹ãªã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ - æ­£æ–¹å½¢é…ç½® -->
    <div class="japanese-keyboard" id="japaneseKeyboard">
        <div class="keyboard-controls">
            <button class="input-mode-switch" id="inputModeSwitch" onclick="toggleInputMode()">
                ãƒ•ãƒªãƒƒã‚¯å…¥åŠ›
            </button>
        </div>
        
        <div class="kana-grid">
            <!-- å·¦å´è£…é£¾ -->
            <div class="decoration-left">
                <div>ğŸŒ¸</div>
                <div>ğŸ¾</div>
                <div>âœ¨</div>
                <div>ğŸµ</div>
            </div>
            
            <!-- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æœ¬ä½“ -->
            <div class="kana-key key-a" data-chars="ã‚ã„ã†ãˆãŠ">ã‚</div>
            <div class="kana-key key-ka" data-chars="ã‹ããã‘ã“">ã‹</div>
            <div class="kana-key key-sa" data-chars="ã•ã—ã™ã›ã">ã•</div>
            
            <div class="kana-key key-ta" data-chars="ãŸã¡ã¤ã¦ã¨">ãŸ</div>
            <div class="kana-key key-na" data-chars="ãªã«ã¬ã­ã®">ãª</div>
            <div class="kana-key key-ha" data-chars="ã¯ã²ãµã¸ã»">ã¯</div>
            
            <div class="kana-key key-ma" data-chars="ã¾ã¿ã‚€ã‚ã‚‚">ã¾</div>
            <div class="kana-key key-ya" data-chars="ã‚„ã‚†ã‚ˆ">ã‚„</div>
            <div class="kana-key key-ra" data-chars="ã‚‰ã‚Šã‚‹ã‚Œã‚">ã‚‰</div>
            
            <div class="kana-key special key-dakuten" onclick="toggleDakuten()">ã‚›ã‚œå°</div>
            <div class="kana-key special key-wa" data-chars="ã‚ã‚’ã‚“ãƒ¼">ã‚ãƒ¼</div>
            <div class="kana-key special key-punct" data-chars="ã€ã€‚ï¼Ÿï¼">ã€ã€‚ï¼Ÿï¼</div>
            
            <!-- å³å´è£…é£¾ -->
            <div class="decoration-right">
                <div>ğŸŒŸ</div>
                <div>ğŸ’«</div>
                <div>ğŸ€</div>
                <div>ğŸ€</div>
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ç„¡åŠ¹åŒ–
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });
        
        document.addEventListener('gesturechange', function (e) {
            e.preventDefault();
        });
        
        document.addEventListener('gestureend', function (e) {
            e.preventDefault();
        });
        
        // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ç„¡åŠ¹åŒ–
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let game = {
            active: false,
            course: '',
            words: [],
            currentWord: 0,
            currentChar: 0,
            currentInput: '',
            targetWord: '',
            score: 0,
            time: 60,
            correct: 0,
            total: 0,
            combo: 0,
            maxCombo: 0,
            timer: null,
            audioContext: null,
            flickMode: true, // ãƒ•ãƒªãƒƒã‚¯å…¥åŠ›ã®ON/OFF
            dakutenMode: false // æ¿ç‚¹ãƒ»å°æ–‡å­—ãƒ¢ãƒ¼ãƒ‰
        };
        
        // ã‚¿ãƒƒãƒ—å…¥åŠ›ç®¡ç†
        let tapData = {
            currentKey: null,
            tapCount: 0,
            tapTimer: null
        };
        
        // æ—¥å¸¸çš„ãªå˜èªãƒªã‚¹ãƒˆ
        const dailyWords = {
            easy: [
                'ã‚ã•', 'ã²ã‚‹', 'ã‚ˆã‚‹', 'ã‚ã‚', 'ã‹ãœ', 'ãã‚‰', 'ã»ã—', 'ã¤ã', 'ã²', 'ã¿ãš',
                'ã‚„ã¾', 'ã†ã¿', 'ã„ãˆ', 'ã¿ã¡', 'ã¯ãª', 'ã', 'ã¨ã‚Š', 'ã„ã¬', 'ã­ã“', 'ã•ã‹ãª'
            ],
            normal: [
                'ã‚ã•ã”ã¯ã‚“', 'ã²ã‚‹ã”ã¯ã‚“', 'ã°ã‚“ã”ã¯ã‚“', 'ãŒã£ã“ã†', 'ã¨ã—ã‚‡ã‹ã‚“', 'ã³ã‚‡ã†ã„ã‚“',
                'ã“ã†ãˆã‚“', 'ã§ã‚“ã—ã‚ƒ', 'ã˜ã©ã†ã—ã‚ƒ', 'ã‹ã„ã‚‚ã®', 'ã‚Šã‚‡ã“ã†', 'ã—ã‚…ã¿'
            ],
            hard: [
                'ãŸã‚“ã˜ã‚‡ã†ã³', 'ã‚¯ãƒªã‚¹ãƒã‚¹', 'ãŠã—ã‚‡ã†ãŒã¤', 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼', 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ',
                'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³', 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°', 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³'
            ],
            expert: [
                'ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«', 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆ', 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³',
                'ã‚¢ãƒ‰ãƒŸãƒ‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 'ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼', 'ã‚¨ãƒ³ãƒã‚¤ãƒ­ãƒ³ãƒ¡ãƒ³ãƒˆ'
            ]
        };
        
        // ãƒ­ãƒ¼ãƒå­—â†’ã²ã‚‰ãŒãªå¤‰æ›
        function toRomaji(hiragana) {
            let result = '';
            let i = 0;
            while (i < hiragana.length) {
                let char = hiragana[i];
                let nextChar = i + 1 < hiragana.length ? hiragana[i + 1] : '';
                let twoCharRomaji = convertTwoChar(char, nextChar);
                if (twoCharRomaji) {
                    result += twoCharRomaji;
                    i += 2;
                } else {
                    let oneCharRomaji = convertOneChar(char);
                    result += oneCharRomaji;
                    i += 1;
                }
            }
            return result;
        }
        
        function convertTwoChar(char1, char2) {
            const twoCharTable = {
                'ãã‚ƒ': 'kya', 'ãã‚…': 'kyu', 'ãã‚‡': 'kyo',
                'ãã‚ƒ': 'gya', 'ãã‚…': 'gyu', 'ãã‚‡': 'gyo',
                'ã—ã‚ƒ': 'sha', 'ã—ã‚…': 'shu', 'ã—ã‚‡': 'sho',
                'ã˜ã‚ƒ': 'ja', 'ã˜ã‚…': 'ju', 'ã˜ã‚‡': 'jo',
                'ã¡ã‚ƒ': 'cha', 'ã¡ã‚…': 'chu', 'ã¡ã‚‡': 'cho',
                'ã«ã‚ƒ': 'nya', 'ã«ã‚…': 'nyu', 'ã«ã‚‡': 'nyo',
                'ã²ã‚ƒ': 'hya', 'ã²ã‚…': 'hyu', 'ã²ã‚‡': 'hyo',
                'ã³ã‚ƒ': 'bya', 'ã³ã‚…': 'byu', 'ã³ã‚‡': 'byo',
                'ã´ã‚ƒ': 'pya', 'ã´ã‚…': 'pyu', 'ã´ã‚‡': 'pyo',
                'ã¿ã‚ƒ': 'mya', 'ã¿ã‚…': 'myu', 'ã¿ã‚‡': 'myo',
                'ã‚Šã‚ƒ': 'rya', 'ã‚Šã‚…': 'ryu', 'ã‚Šã‚‡': 'ryo'
            };
            return twoCharTable[char1 + char2] || null;
        }
        
        function convertOneChar(char) {
            const oneCharTable = {
                'ã‚': 'a', 'ã„': 'i', 'ã†': 'u', 'ãˆ': 'e', 'ãŠ': 'o',
                'ã‹': 'ka', 'ã': 'ki', 'ã': 'ku', 'ã‘': 'ke', 'ã“': 'ko',
                'ãŒ': 'ga', 'ã': 'gi', 'ã': 'gu', 'ã’': 'ge', 'ã”': 'go',
                'ã•': 'sa', 'ã—': 'shi', 'ã™': 'su', 'ã›': 'se', 'ã': 'so',
                'ã–': 'za', 'ã˜': 'ji', 'ãš': 'zu', 'ãœ': 'ze', 'ã': 'zo',
                'ãŸ': 'ta', 'ã¡': 'chi', 'ã¤': 'tsu', 'ã¦': 'te', 'ã¨': 'to',
                'ã ': 'da', 'ã¢': 'di', 'ã¥': 'du', 'ã§': 'de', 'ã©': 'do',
                'ãª': 'na', 'ã«': 'ni', 'ã¬': 'nu', 'ã­': 'ne', 'ã®': 'no',
                'ã¯': 'ha', 'ã²': 'hi', 'ãµ': 'fu', 'ã¸': 'he', 'ã»': 'ho',
                'ã°': 'ba', 'ã³': 'bi', 'ã¶': 'bu', 'ã¹': 'be', 'ã¼': 'bo',
                'ã±': 'pa', 'ã´': 'pi', 'ã·': 'pu', 'ãº': 'pe', 'ã½': 'po',
                'ã¾': 'ma', 'ã¿': 'mi', 'ã‚€': 'mu', 'ã‚': 'me', 'ã‚‚': 'mo',
                'ã‚„': 'ya', 'ã‚†': 'yu', 'ã‚ˆ': 'yo',
                'ã‚‰': 'ra', 'ã‚Š': 'ri', 'ã‚‹': 'ru', 'ã‚Œ': 're', 'ã‚': 'ro',
                'ã‚': 'wa', 'ã‚': 'wi', 'ã‚‘': 'we', 'ã‚’': 'wo', 'ã‚“': 'n',
                'ãƒ¼': '-', 'ã£': '', 'ã‚ƒ': 'ya', 'ã‚…': 'yu', 'ã‚‡': 'yo'
            };
            return oneCharTable[char] || char;
        }
        
        // éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ 
        function initAudioContext() {
            try {
                if (!game.audioContext || game.audioContext.state === 'closed') {
                    game.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (game.audioContext.state === 'suspended') {
                    game.audioContext.resume();
                }
                return game.audioContext;
            } catch (e) {
                return null;
            }
        }
        
        function playNekoSound(type = 'success', intensity = 1) {
            try {
                const audioContext = initAudioContext();
                if (!audioContext) return;
                
                if (type === 'success') {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    osc.frequency.setValueAtTime(660, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.1 * intensity, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                    osc.start(audioContext.currentTime);
                    osc.stop(audioContext.currentTime + 0.2);
                } else if (type === 'complete') {
                    const frequencies = [523, 659, 784];
                    frequencies.forEach((freq, i) => {
                        setTimeout(() => {
                            try {
                                const osc = audioContext.createOscillator();
                                const gain = audioContext.createGain();
                                osc.connect(gain);
                                gain.connect(audioContext.destination);
                                osc.frequency.setValueAtTime(freq, audioContext.currentTime);
                                gain.gain.setValueAtTime(0.08 * intensity, audioContext.currentTime);
                                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                                osc.start(audioContext.currentTime);
                                osc.stop(audioContext.currentTime + 0.3);
                            } catch (e) {}
                        }, i * 80);
                    });
                }
            } catch (e) {
                game.audioContext = null;
            }
        }
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createParticleExplosion(x, y, type = 'normal') {
            const particles = ['ğŸ±', 'âœ¨', 'ğŸŒŸ', 'ğŸ’«'];
            const colors = ['#8D4500', '#D2691E', '#FF8C00'];
            let particleCount = type === 'big' ? 6 : 3;
            let explosionColor = colors[Math.floor(Math.random() * colors.length)];
            
            const explosion = document.createElement('div');
            explosion.className = 'explosion-effect';
            explosion.style.left = (x - 30) + 'px';
            explosion.style.top = (y - 30) + 'px';
            explosion.style.background = `radial-gradient(circle, ${explosionColor}30, transparent)`;
            document.getElementById('effectParticles').appendChild(explosion);
            
            setTimeout(() => {
                if (explosion.parentNode) {
                    explosion.parentNode.removeChild(explosion);
                }
            }, 500);
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                
                const angle = (360 / particleCount) * i;
                const distance = type === 'big' ? 80 : 50;
                const radian = (angle * Math.PI) / 180;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.transform = `translate(${Math.cos(radian) * distance}px, ${Math.sin(radian) * distance}px)`;
                
                document.getElementById('effectParticles').appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 2000);
            }
        }
        
        // å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleInputMode() {
            game.flickMode = !game.flickMode;
            const switchBtn = document.getElementById('inputModeSwitch');
            switchBtn.textContent = game.flickMode ? 'ãƒ•ãƒªãƒƒã‚¯å…¥åŠ›' : 'ã‚±ãƒ¼ã‚¿ã‚¤å…¥åŠ›';
        }
        
        // æ¿ç‚¹ãƒ»å°æ–‡å­—ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleDakuten() {
            game.dakutenMode = !game.dakutenMode;
            const dakutenBtn = document.querySelector('.key-dakuten');
            dakutenBtn.style.background = game.dakutenMode ? '#007AFF' : '#acb2b9';
            dakutenBtn.style.color = game.dakutenMode ? 'white' : '#000';
        }
        
        // ãƒ•ãƒªãƒƒã‚¯ãƒ»ã‚±ãƒ¼ã‚¿ã‚¤å…¥åŠ›å‡¦ç†
        let touchData = {
            startX: 0,
            startY: 0,
            currentKey: null,
            isFlicking: false
        };
        
        function setupFlickInput() {
            const kanaKeys = document.querySelectorAll('.kana-key[data-chars]');
            
            kanaKeys.forEach(key => {
                // ã‚¿ãƒƒãƒé–‹å§‹
                key.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    touchData.startX = touch.clientX;
                    touchData.startY = touch.clientY;
                    touchData.currentKey = key;
                    touchData.isFlicking = false;
                    
                    if (game.flickMode) {
                        showFlickPopup(key);
                    }
                });
                
                // ã‚¿ãƒƒãƒç§»å‹•
                key.addEventListener('touchmove', (e) => {
                    if (!touchData.currentKey || !game.flickMode) return;
                    e.preventDefault();
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - touchData.startX;
                    const deltaY = touch.clientY - touchData.startY;
                    const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    
                    if (distance > 20) {
                        touchData.isFlicking = true;
                        updateFlickPopup(key, deltaX, deltaY);
                    }
                });
                
                // ã‚¿ãƒƒãƒçµ‚äº†
                key.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (!touchData.currentKey) return;
                    
                    let inputChar;
                    if (game.flickMode && touchData.isFlicking) {
                        // ãƒ•ãƒªãƒƒã‚¯å…¥åŠ›
                        const touch = e.changedTouches[0];
                        const deltaX = touch.clientX - touchData.startX;
                        const deltaY = touch.clientY - touchData.startY;
                        inputChar = getFlickChar(key, deltaX, deltaY);
                    } else {
                        // ã‚±ãƒ¼ã‚¿ã‚¤å…¥åŠ›ï¼ˆé€£ç¶šã‚¿ãƒƒãƒ—æ–¹å¼ï¼‰
                        handleTapInput(key);
                        hideFlickPopup();
                        touchData.currentKey = null;
                        return;
                    }
                    
                    if (inputChar) {
                        inputKana(inputChar);
                    }
                    
                    hideFlickPopup();
                    touchData.currentKey = null;
                    touchData.isFlicking = false;
                });
                
                // ã‚¯ãƒªãƒƒã‚¯ï¼ˆPCç”¨ï¼‰
                key.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (touchData.currentKey) return; // ã‚¿ãƒƒãƒå‡¦ç†ä¸­ã¯ç„¡è¦–
                    
                    if (game.flickMode) {
                        const chars = key.dataset.chars;
                        if (chars) {
                            inputKana(chars[0]); // æœ€åˆã®æ–‡å­—
                        }
                    } else {
                        handleTapInput(key);
                    }
                });
            });
        }
        
        // ã‚±ãƒ¼ã‚¿ã‚¤å…¥åŠ›å‡¦ç†ï¼ˆé€£ç¶šã‚¿ãƒƒãƒ—æ–¹å¼ï¼‰
        function handleTapInput(key) {
            const chars = key.dataset.chars;
            if (!chars) return;
            
            // åŒã˜ã‚­ãƒ¼ã®é€£ç¶šã‚¿ãƒƒãƒ—
            if (tapData.currentKey === key) {
                tapData.tapCount = (tapData.tapCount + 1) % chars.length;
            } else {
                // æ–°ã—ã„ã‚­ãƒ¼
                if (tapData.currentKey && tapData.tapTimer) {
                    // å‰ã®ã‚­ãƒ¼ã®æ–‡å­—ã‚’ç¢ºå®š
                    const prevChars = tapData.currentKey.dataset.chars;
                    if (prevChars) {
                        inputKana(prevChars[tapData.tapCount]);
                    }
                }
                tapData.currentKey = key;
                tapData.tapCount = 0;
            }
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (tapData.tapTimer) {
                clearTimeout(tapData.tapTimer);
            }
            
            // ç¾åœ¨ã®æ–‡å­—ã‚’è¡¨ç¤ºï¼ˆä»®ï¼‰
            console.log('ã‚±ãƒ¼ã‚¿ã‚¤å…¥åŠ›:', chars[tapData.tapCount]);
            
            // 1ç§’å¾Œã«æ–‡å­—ã‚’ç¢ºå®š
            tapData.tapTimer = setTimeout(() => {
                if (tapData.currentKey) {
                    const currentChars = tapData.currentKey.dataset.chars;
                    if (currentChars) {
                        inputKana(currentChars[tapData.tapCount]);
                    }
                    tapData.currentKey = null;
                    tapData.tapCount = 0;
                }
            }, 1000);
        }
        
        function showFlickPopup(key) {
            const popup = document.createElement('div');
            popup.className = 'flick-popup';
            popup.id = 'flickPopup';
            
            const chars = key.dataset.chars;
            if (!chars) return;
            
            // ãƒ•ãƒªãƒƒã‚¯æ–¹å‘ã«æ–‡å­—ã‚’é…ç½®
            let charsHtml = '';
            charsHtml += `<div class="flick-char center active">${chars[0] || ''}</div>`; // ä¸­å¤®
            charsHtml += `<div class="flick-char up">${chars[2] || ''}</div>`; // ä¸Š
            charsHtml += `<div class="flick-char right">${chars[3] || ''}</div>`; // å³
            charsHtml += `<div class="flick-char down">${chars[4] || ''}</div>`; // ä¸‹
            charsHtml += `<div class="flick-char left">${chars[1] || ''}</div>`; // å·¦
            
            popup.innerHTML = `<div class="flick-chars">${charsHtml}</div>`;
            key.appendChild(popup);
            popup.style.display = 'block';
        }
        
        function updateFlickPopup(key, deltaX, deltaY) {
            const popup = document.getElementById('flickPopup');
            if (!popup) return;
            
            const chars = popup.querySelectorAll('.flick-char');
            
            // ãƒ•ãƒªãƒƒã‚¯æ–¹å‘ã‚’åˆ¤å®š
            let direction = 'center';
            const threshold = 30;
            
            if (Math.abs(deltaX) > threshold || Math.abs(deltaY) > threshold) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    direction = deltaX > 0 ? 'right' : 'left';
                } else {
                    direction = deltaY < 0 ? 'up' : 'down';
                }
            }
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ–‡å­—ã‚’æ›´æ–°
            chars.forEach(char => {
                char.classList.remove('active');
                if (char.classList.contains(direction)) {
                    char.classList.add('active');
                }
            });
        }
        
        function getFlickChar(key, deltaX, deltaY) {
            const chars = key.dataset.chars;
            if (!chars) return null;
            
            let direction = 0; // 0:ä¸­å¤®, 1:å·¦, 2:ä¸Š, 3:å³, 4:ä¸‹
            const threshold = 30;
            
            if (Math.abs(deltaX) > threshold || Math.abs(deltaY) > threshold) {
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    direction = deltaX > 0 ? 3 : 1; // å³ or å·¦
                } else {
                    direction = deltaY < 0 ? 2 : 4; // ä¸Š or ä¸‹
                }
            }
            
            return chars[direction] || chars[0];
        }
        
        function hideFlickPopup() {
            const popup = document.getElementById('flickPopup');
            if (popup) {
                popup.remove();
            }
        }
        
        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame(course) {
            console.log('NEKOPON RENDAé–‹å§‹:', course);
            initAudioContext();
            
            game.active = true;
            game.course = course;
            game.words = [...dailyWords[course]];
            game.currentWord = 0;
            game.currentChar = 0;
            game.currentInput = '';
            game.score = 0;
            game.time = 60;
            game.correct = 0;
            game.total = 0;
            game.combo = 0;
            game.maxCombo = 0;
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            for (let i = game.words.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [game.words[i], game.words[j]] = [game.words[j], game.words[i]];
            }
            
            game.targetWord = game.words[game.currentWord];
            
            document.getElementById('menu').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            
            updateDisplay();
            startTimer();
            playNekoSound('complete', 1.2);
        }
        
        function updateDisplay() {
            const targetWord = game.targetWord;
            const romajiWord = toRomaji(targetWord);
            
            // æ—¥æœ¬èªè¡¨ç¤º
            let japaneseHtml = '';
            for (let i = 0; i < targetWord.length; i++) {
                if (i < game.currentChar) {
                    japaneseHtml += `<span class="typed">${targetWord[i]}</span>`;
                } else if (i === game.currentChar) {
                    japaneseHtml += `<span class="current">${targetWord[i]}</span>`;
                } else {
                    japaneseHtml += `<span class="remaining">${targetWord[i]}</span>`;
                }
            }
            document.getElementById('word').innerHTML = japaneseHtml;
            
            // ãƒ­ãƒ¼ãƒå­—è¡¨ç¤º
            document.getElementById('romaji').textContent = romajiWord;
            
            document.getElementById('score').textContent = game.score;
            const accuracy = game.total > 0 ? Math.round((game.correct / game.total) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
            const progress = (game.currentChar / targetWord.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }
        
        function updateCombo() {
            const comboElement = document.getElementById('combo');
            if (game.combo > 4) {
                comboElement.innerHTML = `<div class="combo-text">${game.combo} COMBO!</div>`;
                game.maxCombo = Math.max(game.maxCombo, game.combo);
            } else {
                comboElement.innerHTML = '';
            }
        }
        
        function startTimer() {
            if (game.timer) clearInterval(game.timer);
            
            game.timer = setInterval(() => {
                game.time--;
                document.getElementById('time').textContent = game.time;
                
                if (game.time <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        function endGame() {
            game.active = false;
            if (game.timer) {
                clearInterval(game.timer);
                game.timer = null;
            }
            
            // ãƒ•ã‚£ãƒŠãƒ¼ãƒ¬ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    createParticleExplosion(
                        Math.random() * window.innerWidth,
                        Math.random() * (window.innerHeight - 280),
                        'big'
                    );
                }, i * 150);
            }
            
            playNekoSound('complete', 2);
            setTimeout(showResults, 1500);
        }
        
        function showResults() {
            const targets = {
                easy: 1000,
                normal: 2000,
                hard: 3500,
                expert: 5000
            };
            const target = targets[game.course];
            const accuracy = game.total > 0 ? Math.round((game.correct / game.total) * 100) : 100;
            
            let rank = '';
            if (game.score >= target * 1.5) {
                rank = 'ğŸ‘‘ NEKOPON ä¼èª¬ ğŸ‘‘';
            } else if (game.score >= target) {
                rank = 'ğŸŒŸ ç›®æ¨™é”æˆã«ã‚ƒã€œï¼ ğŸŒŸ';
            } else if (game.score >= target * 0.8) {
                rank = 'ğŸ± ã‚‚ã†å°‘ã—ã«ã‚ƒã€œ ğŸ±';
            } else {
                rank = 'ğŸ’ª ç·´ç¿’ã™ã‚‹ã«ã‚ƒã€œ ğŸ’ª';
            }
            
            document.getElementById('result-text').innerHTML = `
                <div style="font-size: 1.2em; margin: 15px 0;">${rank}</div>
                <div style="margin: 10px 0;"><strong>âœ¨ ã‚¹ã‚³ã‚¢:</strong> ${game.score} / ${target}</div>
                <div style="margin: 10px 0;"><strong>ğŸ”¥ æ­£ç¢ºç‡:</strong> ${accuracy}%</div>
                <div style="margin: 10px 0;"><strong>ğŸ† æœ€å¤§ã‚³ãƒ³ãƒœ:</strong> ${game.maxCombo}å›</div>
                <div style="margin: 10px 0;"><strong>ğŸ’• å…¥åŠ›æ–‡å­—æ•°:</strong> ${game.correct}æ–‡å­—</div>
            `;
            
            document.getElementById('game').style.display = 'none';
            document.getElementById('result').style.display = 'block';
            playNekoSound('complete', 1.5);
        }
        
        function resetGame() {
            document.getElementById('result').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
            document.getElementById('time').textContent = '60';
            document.getElementById('score').textContent = '0';
            document.getElementById('accuracy').textContent = '100%';
            document.getElementById('combo').innerHTML = '';
            document.getElementById('progress').style.width = '0%';
            
            if (game.timer) {
                clearInterval(game.timer);
                game.timer = null;
            }
        }
        
        // ã‹ãªæ–‡å­—å…¥åŠ›å‡¦ç†
        function inputKana(char) {
            if (!game.active) return;
            
            if (char === 'backspace') {
                if (game.currentInput.length > 0) {
                    game.currentInput = game.currentInput.slice(0, -1);
                    game.currentChar = game.currentInput.length;
                }
                updateDisplay();
                return;
            }
            
            if (char === 'enter' || char === ' ') return;
            
            // æ¿ç‚¹ãƒ»å°æ–‡å­—å‡¦ç†
            if (game.dakutenMode && char) {
                char = convertToDakuten(char);
                game.dakutenMode = false;
                toggleDakuten();
            }
            
            game.total++;
            game.currentInput += char;
            
            console.log('ã‹ãªå…¥åŠ›:', char, 'ç¾åœ¨ã®å…¥åŠ›:', game.currentInput, 'ç›®æ¨™:', game.targetWord);
            
            if (game.targetWord.startsWith(game.currentInput)) {
                // æ­£è§£
                game.correct++;
                game.currentChar = game.currentInput.length;
                game.combo++;
                
                // ã‚¹ã‚³ã‚¢è¨ˆç®—
                let baseScore = 15;
                let comboBonus = Math.floor(game.combo / 3) * 8;
                let timeBonus = game.time > 40 ? 7 : 0;
                game.score += baseScore + comboBonus + timeBonus;
                
                playNekoSound('success', 1);
                updateCombo();
                
                // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                createParticleExplosion(
                    Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1,
                    Math.random() * (window.innerHeight - 280) * 0.6
                );
                
                // å˜èªå®Œæˆãƒã‚§ãƒƒã‚¯
                if (game.currentInput === game.targetWord) {
                    // å˜èªå®Œæˆ
                    game.score += 100;
                    game.combo += 10;
                    game.currentWord = (game.currentWord + 1) % game.words.length;
                    game.currentChar = 0;
                    game.currentInput = '';
                    
                    if (game.currentWord === 0) {
                        // å…¨å˜èªå®Œäº†ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«
                        for (let i = game.words.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [game.words[i], game.words[j]] = [game.words[j], game.words[i]];
                        }
                    }
                    
                    game.targetWord = game.words[game.currentWord];
                    console.log('æ–°ã—ã„å˜èª:', game.targetWord);
                    
                    // å˜èªå®Œæˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                    for (let i = 0; i < 5; i++) {
                        setTimeout(() => {
                            createParticleExplosion(
                                Math.random() * window.innerWidth,
                                Math.random() * (window.innerHeight - 280) * 0.8,
                                'big'
                            );
                        }, i * 100);
                    }
                    
                    playNekoSound('complete', 1.3);
                }
            } else {
                // ä¸æ­£è§£
                game.combo = 0;
                game.currentInput = ''; // ãƒªã‚»ãƒƒãƒˆ
                game.currentChar = 0;
                updateCombo();
            }
            
            updateDisplay();
        }
        
        // æ¿ç‚¹ãƒ»å°æ–‡å­—å¤‰æ›
        function convertToDakuten(char) {
            const dakutenMap = {
                'ã‹': 'ãŒ', 'ã': 'ã', 'ã': 'ã', 'ã‘': 'ã’', 'ã“': 'ã”',
                'ã•': 'ã–', 'ã—': 'ã˜', 'ã™': 'ãš', 'ã›': 'ãœ', 'ã': 'ã',
                'ãŸ': 'ã ', 'ã¡': 'ã¢', 'ã¤': 'ã¥', 'ã¦': 'ã§', 'ã¨': 'ã©',
                'ã¯': 'ã°', 'ã²': 'ã³', 'ãµ': 'ã¶', 'ã¸': 'ã¹', 'ã»': 'ã¼',
                'ã°': 'ã±', 'ã³': 'ã´', 'ã¶': 'ã·', 'ã¹': 'ãº', 'ã¼': 'ã½',
                'ã‚„': 'ã‚ƒ', 'ã‚†': 'ã‚…', 'ã‚ˆ': 'ã‚‡', 'ã¤': 'ã£'
            };
            return dakutenMap[char] || char;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupFlickInput();
        });
        
        document.addEventListener('click', initAudioContext, { once: true });
        
        console.log('ğŸ± NEKOPON RENDA å®Œå…¨ç‰ˆ åˆæœŸåŒ–å®Œäº†ï¼ ğŸ±');
    </script>
</body>
</html>